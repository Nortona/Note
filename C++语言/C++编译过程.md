# C++编译过程

`C++`是一种高级编程语言，但是计算机并不能直接理解它。因此，需要将`C++`代码翻译成计算机可以理解的机器语言。这个过程就是编译过程，是`C++`程序从源代码到可执行文件的转换过程，包括**预处理、编译、汇编和链接**四个阶段。

## 1. 预处理

在编译器开始编译之前，会先进行预处理。预处理器会处理代码中的所有预处理指令，例如`#include`和`#define`等。它会将这些指令替换成对应的代码，生成一个新的文本文件。这个新的文本文件就是编译器的输入。在预处理的过程中，还会进行条件编译，即根据条件来选择是否编译某些代码块。预处理完成后，会生成一个没有宏定义和条件编译的中间文件。

预处理器的主要作用是解决代码中的宏定义，它会将宏定义展开成对应的代码。此外，预处理器还会处理`#include`指令，将指定的头文件插入到源文件中，以便让编译器能够对头文件中的函数和变量进行编译。

## 2. 编译

编译器将预处理后的文件作为输入，对其进行词法分析、语法分析和语义分析等处理。这些处理会将代码转化成中间代码，中间代码是一种类似于汇编语言的低级代码。编译器将代码分成多个模块，每个模块编译成一个对象文件。在编译的过程中，编译器会对代码进行优化，以提高程序的运行效率和节省内存空间。

在词法分析和语法分析的过程中，编译器会对代码进行检查，以确保代码的正确性和合法性。语义分析的任务是在代码的语法结构上进行分析，以确定代码的含义和作用。

```shell
g++ main.cpp -c 

//得到main.o
```


## 3. 汇编

中间代码会被汇编器转化成机器语言指令，这些指令可以被计算机直接执行。汇编的过程将每个对象文件转换成机器语言的目标文件。每个目标文件包含机器指令和数据，以及其他的控制信息。目标文件可以被链接器用于构建可执行文件。

汇编器的主要任务是将中间代码翻译成机器语言指令，以便让计算机能够执行代码。在这个过程中，汇编器会将每个源文件编译成一个目标文件，然后将所有的目标文件组合成一个可执行文件。

## 4. 链接

在编译过程中，可能会用到其他的库文件和对象文件。链接器会将这些文件与生成的可执行文件进行链接，生成最终的可执行文件。链接器的主要任务是解决符号引用问题，即通过在不同的目标文件中查找符号的定义，使得所有的符号都能够正确地被解析和链接。链接器还会对代码进行优化和压缩，以减小可执行文件的体积，并提高程序的运行效率。

链接器的工作包括将每个目标文件中的符号解析成地址，并将它们组合成一个单独的地址空间。链接器还会处理代码中的重定位信息，以确保代码能够正确地加载和执行。

```shell
g++ *.o -o 

//得到main
```


## 结论

`C++`编译过程是一个非常复杂的过程，它需要经过多次处理才能最终生成可执行文件。但是，了解这个过程对于理解`C++`代码和调试程序都非常有帮助。在实际的开发中，程序员需要掌握编译工具链的使用，以便能够更好地进行调试和优化。同时，程序员还需要了解编译器的工作原理和优化技术，以写出高效的`C++`代码。


# 静态库和动态库如何制作及使用，区别是什么
1. 静态库的制作和使用 - 命名规则 Linux : libxxx.a lib : 前缀（固定） xxx : 库的名字，自己起 .a : 后缀（固定） Windows : libxxx.lib - 制作 a.gcc 获得 .o 文件 gcc xxx.c xxx.c -c b.将 .o 文件打包，使用 ar 工具（archive） ar rcs libxxx.a xxx.o xxx.o - 使用 静态库使用需要有库文件和头文件，编译程序时通过 “-l 静态库名” 参数进行编译。 

2. 动态库的制作 - 命名规则 Linux : libxxx.so lib : 前缀（固定） xxx : 库的名字，自己起 .so : 后缀（固定） Windows : libxxx.dll - 制作 a.gcc 得到 .o 文件，得到和位置无关的代码 gcc -c –fpic/-fPIC a.c b.c b.gcc 得到动态库 gcc -shared a.o b.o -o libcalc.so - 使用 动态库使用需要有库文件和头文件，编译程序时通过 “-l 动态库名” 参数进行编译。在运行程序之前还需要配置动态库的加载路径，程序才能够正常运行。

3. 静态库和动态的区别 
- 静态库 gcc 进行链接时，会把静态库中代码打包到可执行程序中，编译时加载；发布程序时无需提供静态库，移植方便；消耗内存，更新部署发布麻烦。 
- 动态库 gcc 进行链接时，动态库的代码不会被打包到可执行程序中，运行时加载；发布程序时需要提供动态库；内存占用小，更新部署发布简单。

# 请你说说动态库静态库的区别和优缺点
1. 命令方式不同 
- 静态库命名 Linux : libxxx.a         lib : 前缀（固定） xxx : 库的名字，自己起 .a : 后缀（固定） Windows : libxxx.lib 
- 动态库命名 Linux : libxxx.so       lib : 前缀（固定） xxx : 库的名字，自己起 .so : 后缀（固定） Windows : libxxx.dll 

2. 链接时间和方式不同 
- 静态库的链接是将整个函数库的所有数据在编译时都整合进了目标代码 
- 动态库的链接是程序执行到哪个函数链接哪个函数的库 

静态库和动态库的优缺点： 
1. 静态库优缺点 
- 优点：发布程序时无需提供静态库，移植方便，运行速度相对快些
- 缺点：静态链接生成的可执行文件体积较大，消耗内存，如果所使用的静态库发生更新改变，程序必须重新编译，更新麻烦。 

2. 动态库优缺点
- 优点：更加节省内存并减少页面交换，动态库改变并不影响使用的程序，动态函数库升级比较方便 
- 缺点：发布程序时需要提供动态库

